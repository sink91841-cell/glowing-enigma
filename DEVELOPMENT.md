\# 开发过程记录

本文档记录项目的开发思路、技术选型、核心问题及解决方案，便于后续维护和迭代。



\## 项目背景

\### 核心需求

用户需要一款：

1\. 国内网络可用（无需代理）

2\. 免费AI驱动（无付费成本）

3\. 支持多类型报刊（PDF/图片）

4\. 结构化输出精华内容

5\. 新手友好（低使用门槛）



\### 目标用户

\- 自媒体创作者

\- 学习Python的新手

\- 需要快速获取报刊核心内容的个人用户



\## 技术选型

\### 核心库选型

| 功能 | 技术选型 | 选型理由 |

|------|----------|----------|

| 网络请求 | requests | 轻量、易用、支持超时/重试，国内网络适配好 |

| 图片处理 | Pillow | Python主流图片库，支持压缩、格式转换、尺寸调整 |

| PDF处理 | pdf2image | 轻量级PDF转图片库，适配多平台，依赖poppler（成熟工具） |

| AI解析 | 通义千问qwen-vl-plus | 国内直连、免费额度充足、支持多模态（图文解析） |

| 日期处理 | datetime | Python内置库，无需额外依赖，满足日期格式化需求 |

| 正则表达式 | re | 轻量高效，用于提取网页中的PDF链接 |



\### AI模型对比

| 模型 | 优势 | 劣势 | 最终选择 |

|------|------|------|----------|

| 百度文心一言 | 中文解析效果好 | 需要付费API Key，部分功能需代理 | ❌ |

| 通义千问免费版 | 国内直连、免费、多模态支持 | 免费版有调用次数限制 | ✅ |

| ChatGPT | 解析效果好 | 需要代理、付费 | ❌ |



\## 开发阶段

\### 阶段1：需求分析与原型设计（2026-02-18）

\- 明确核心流程：日期选择 → 报纸选择 → 下载 → AI解析 → 保存

\- 确定支持的报刊类型：人民日报（PDF）、经济日报（PDF）、纽约时报（图片）

\- 设计结构化输出格式（头条+数据+主题）



\### 阶段2：核心功能开发（2026-02-19）

\- 实现报刊文件下载逻辑

&nbsp; - 人民日报/经济日报：动态提取PDF链接（正则匹配）

&nbsp; - 纽约时报：直接下载头版图片

\- 集成基础AI解析功能（百度文心一言）

\- 实现基础的文件保存功能



\### 阶段3：AI模型替换与优化（2026-02-20）

\- 替换为通义千问qwen-vl-plus免费模型

\- 实现PDF转图片 + base64编码（适配多模态API）

\- 优化AI提示词，提升解析准确性

\- 增加依赖检查功能



\### 阶段4：错误处理与兼容性优化（2026-02-21至23）

\- 完善异常处理（网络超时、文件缺失、API错误）

\- 解决Python环境不一致导致的依赖缺失问题

\- 修复文件路径错误导致的运行失败问题

\- 优化用户交互提示



\### 阶段5：高级功能与鲁棒性提升（2026-02-26）

\- 支持环境变量自定义AI提示词

\- 新增AI返回内容兼容解析逻辑

\- 增加备用解析方案，降低失败率

\- 完善错误堆栈输出，便于调试



\## 核心问题与解决方案

\### 问题1：AI返回格式不统一导致解析失败

\- 现象：通义千问API返回格式可能是`output->text`或`output->choices->message->content`

\- 解决方案：

&nbsp; 1. 主逻辑适配`choices`结构

&nbsp; 2. 增加异常捕获，自动降级到备用解析方案

&nbsp; 3. 兼容列表/字符串两种`content`格式



\### 问题2：Python环境不一致导致依赖缺失

\- 现象：用户安装了requests但运行时提示找不到模块

\- 解决方案：

&nbsp; 1. 文档中明确说明使用`python -m pip install`

&nbsp; 2. 增加依赖检查函数，提前提示缺失的库

&nbsp; 3. 输出清晰的环境不一致提示



\### 问题3：文件路径错误导致运行失败

\- 现象：提示`No such file or directory`

\- 解决方案：

&nbsp; 1. 文档中强调进入项目目录的重要性

&nbsp; 2. 自动创建所需文件夹（newspaper\_images/newspaper\_copies）

&nbsp; 3. 输出文件保存路径，便于用户核对



\### 问题4：PDF转图片跨平台兼容问题

\- 现象：Windows用户缺少poppler导致转换失败

\- 解决方案：

&nbsp; 1. 文档中分系统说明poppler安装方法

&nbsp; 2. 增加ImportError捕获，提示具体安装步骤

&nbsp; 3. 支持手动指定poppler路径（代码中预留配置项）



\## 未来迭代计划

\### v1.4.0 计划

\- \[ ] 支持批量处理指定日期范围的报刊

\- \[ ] 增加配置文件（config.ini），无需修改代码即可配置

\- \[ ] 支持更多输出格式（Markdown/Excel/JSON）

\- \[ ] 增加日志文件，记录运行过程和错误



\### v2.0.0 计划

\- \[ ] 开发简易GUI界面（tkinter/Streamlit）

\- \[ ] 支持本地OCR fallback（无网络时使用）

\- \[ ] 增加内容分类功能（政治/经济/国际/民生）

\- \[ ] 支持定时任务，自动抓取每日报刊



\## 开发规范

\### 代码规范

\- 遵循PEP 8编码规范

\- 函数/变量使用蛇形命名法（snake\_case）

\- 关键函数添加文档字符串（docstring）

\- 异常捕获覆盖所有可能的错误场景

\- 重要逻辑添加注释说明



\### 提交规范

\- 提交信息格式：`\[类型] 描述`，如`\[修复] 修复AI解析JSON格式错误`

\- 类型分类：新增、修复、改进、文档、重构

\- 每次提交仅修改一个功能/修复一个问题

