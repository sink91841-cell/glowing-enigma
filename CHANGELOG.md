# Changelog
所有显著的功能变更、Bug修复都会记录在此文件中。

## 规范说明
- 版本号遵循 [语义化版本 2.0.0](https://semver.org/lang/zh-CN/)
- 变更分类：新增 | 修复 | 改进 | 文档 | 重构 | 移除
- 时间格式：YYYY-MM-DD
- 内容视角：以「用户能感知到的变化」为核心，兼顾开发者维护视角

## [未发布]
### 新增
- 待上线的功能

### 修复
- 待修复的Bug

## [1.5.0] - 2026-02-28
### 重构
- 🔧 核心重构：将原单文件 `newspaper_ai_extractor.py` 拆分为模块化架构，提升可维护性和扩展性：
  - `main.py`：程序主入口，负责启动流程、用户交互、初始化
  - `config.py`：配置管理模块，集中处理.env环境变量、配置项读取和兜底逻辑
  - `downloader.py`：下载专用模块，封装人民日报/经济日报/纽约时报的PDF/图片下载逻辑
  - `ai_client.py`：AI客户端模块，独立封装通义千问API调用、返回内容解析逻辑
  - `file_processor.py`：文件处理模块，负责PDF转图片、base64编码、解析结果保存
  - `utils.py`：工具函数模块，抽离日期格式化、依赖检查、文件夹初始化等通用功能
  - `services/newspaper_tool.py`：核心服务整合模块，串联「下载→文件处理→AI解析→保存」全流程
- 🔧 模块间解耦：各模块通过函数调用交互，避免全局变量依赖，便于单独测试和扩展

### 改进
- 🚀 配置读取逻辑优化：统一在 `config.py` 中管理所有配置项，其他模块仅需导入，无需重复读取.env
- 🚀 错误处理分层：不同模块的异常单独捕获，错误提示更精准（如下载失败/AI调用失败区分提示）
- 🚀 代码复用提升：通用工具函数抽离到 `utils.py`，避免重复代码

### 文档
- 📝 更新README.md，补充项目模块化结构说明
- 📝 新增模块功能说明注释，每个模块头部添加功能概述和使用示例

### 兼容
- 🟢 功能完全兼容：模块化拆分后，用户使用流程（安装→配置→运行）无任何变化，无需修改.env或操作方式


# 修改日志
## [1.5.0] - 2026-02-28
### 新增

### 修复的问题

1. **内容审核失败**
   - 优化了AI提示词，使其更加客观、中立，避免内容审核风险
   - 改进了图片处理方式：
     - 减小图片最大尺寸从1024px改为800px
     - 降低PDF转换的DPI从150改为120
     - 调整图片质量为75（适中）
     - 更严格的文件大小限制（3MB）

2. **数据库连接失败**
   - 更新了数据库密码为 `wxb061017`
   - 添加了自动创建数据库的功能，当数据库不存在时自动创建

. **数据库关闭连接错误**
   - 修复了 `close` 方法，移除了不存在的 `is_connected` 属性调用


1. **图片处理优化**
   - 增强了图片压缩机制，确保文件大小符合API要求
   - 改进了错误处理，提供更友好的错误提示

2. **数据库功能**
   - 实现了自动数据库创建
   - 优化了数据库连接和关闭逻辑

3. **用户体验**
   - 提供更详细的错误信息和解决方案
   - 优化了程序的稳定性和可靠性

## 使用说明

- **下载功能**：支持下载人民日报（PDF）和纽约时报（图片）
- **AI解析**：使用通义千问API解析报纸内容
- **保存功能**：支持将解析结果保存到文件和数据库
- **数据库**：自动创建数据库和数据表，无需手动配置

## 注意事项

- **API Key**：需要在 `.env` 文件中配置通义千问API Key
- **网络连接**：纽约时报需要稳定的网络连接（可能需要VPN）
- **依赖库**：需要安装必要的依赖库（见 `utils.py` 中的依赖检查）

## [1.4.0] - 2026-02-27
### 新增
- ✅ 彻底移除所有硬编码内容（密钥、地址、提示词、AI参数），全部迁移到.env配置文件
- ✅ 新增.env.example模板文件，提供配置参考（无真实密钥）
- ✅ 新增.gitignore文件，严格排除.env（敏感配置）和生成文件
### 改进
- 🚀 所有配置项添加兜底值，避免配置缺失导致程序崩溃
- 🚀 API Key检查逻辑优化，未配置时给出清晰的配置指引
### 安全
- 🔒 杜绝密钥提交到代码仓库的风险，符合开源项目安全规范

## [1.3.0] - 2026-02-26
### 新增
- ✅ 新增 `.env.example` 配置模板文件，支持通过环境变量自定义所有配置项（无需修改主代码）
- ✅ 新增 `.gitignore` 文件，避免提交敏感信息（API Key）和生成的报刊/解析文件
- ✅ 集成 `python-dotenv` 库，自动读取 `.env` 配置，降低使用门槛
### 改进
- 🚀 优化AI返回内容的兼容解析逻辑，支持多种返回格式，降低解析失败率
- 🚀 提升图片压缩效率，减少AI接口传输耗时
### 文档
- 📝 更新README.md，新增「配置文件使用说明」小节

## [1.2.0] - 2026-02-23
### 新增
- ✅ 完善全场景错误处理（网络超时、文件缺失、API调用失败）
- ✅ 新增Python环境检测，提示依赖安装到正确环境
### 修复
- 🐞 修复通义千问API返回JSON解析错误的问题
- 🐞 修复PDF转图片时尺寸过大导致解析失败的问题
- 🐞 修复日期选择时未来日期验证失效的问题
### 改进
- 🚀 降低AI温度参数（0.1），保证输出结果的稳定性
- 🚀 优化用户交互提示，操作指引更清晰

## [1.1.0] - 2026-02-20
### 新增
- ✅ 替换为通义千问qwen-vl-plus免费AI模型，国内网络直连无需代理
- ✅ 实现PDF转图片+base64编码，适配多模态AI接口
- ✅ 支持AI解析结果自动保存为TXT文件
### 修复
- 🐞 修复人民日报/经济日报PDF链接动态提取失败的问题
- 🐞 修复纽约时报图片下载404的问题
### 改进
- 🚀 优化报纸下载逻辑，增加文件存在性检查（避免重复下载）

## [1.0.0] - 2026-02-19
### 新增
- ✅ 初始版本发布，支持人民日报/经济日报/纽约时报的文件下载
- ✅ 基础AI解析功能（百度文心一言）
- ✅ 核心交互流程（日期选择→报纸选择→下载）